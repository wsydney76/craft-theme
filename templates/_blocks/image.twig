{% from '_macros/lib.twig' import img %}


{% set imgWidth = block.width == 'default' ? theme.defaultBlockTypeWidth['image'] : block.width %}
 {# TODO: Add responsive sizes #}


{% set image = block.image.one() %}
{% if image %}

    {% set colSpan = colSpan ?? 12 %}

    {% if columnsWidth is defined and columnsWidth != 'default' %}
        {% set width = theme.widths[columnsWidth ?? 'lg'] %}
    {% else %}
        {% set width = theme.widths[width ?? 'lg'] %}
    {% endif %}

    {% set width = ceil(width / 12 * colSpan) %}

    {% set aspectRatio = block.aspectRatio ?? 'auto' %}

    {% if aspectRatio == 'default' %}
        {% set aspectRatio = theme.defaultAspectRatio %}
    {% endif %}

    {% if aspectRatio == 'fullwidth' %}
        {% set transform = {width: theme.widths['full'], height: theme.fullwidthImageHeight} %}
    {% elseif aspectRatio != 'auto' %}
        {% set aspectRatio = aspectRatio|split(':') %}
        {% set height = floor(width / aspectRatio[0] * aspectRatio[1]) %}
        {% set transform = {width: width, height: height} %}
    {% else %}
        {% set transform = {width: width} %}
    {% endif %}


    {% set transform = transform|merge({format: 'webp'}) %}

    <figure class="figure">

        {{ img(image, transform) }}

        {% if block.caption %}
            <figcaption class="text-center mt-2 text-base">
                {{ block.caption }}
            </figcaption>
        {% endif %}
    </figure>

{% endif %}

