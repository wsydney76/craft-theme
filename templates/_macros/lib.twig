{% macro img(image, transform, class = '') %}

    {% set srcSet = [] %}
    {% if transform.width is defined %}
        {% set srcSet = [transform.width] %}
        {% for responsiveWidth in theme.responsiveWidths %}
            {% if responsiveWidth < transform.width %}
                {% set srcSet = srcSet|push(responsiveWidth) %}
            {% endif %}
        {% endfor %}
    {% endif %}

    {% if transform.format is not defined %}
        {% set transform = transform|merge({format: 'webp'}) %}
    {% endif %}

    {% do image.setTransform(transform) %}

    {{ tag('img', {
        src: image.url,
        height: image.height,
        width: image.width,
        alt: image.altText ?: image.title,
        srcset: image.srcset(srcSet),
        loading: 'lazy',
        class: class
    }) }}
{% endmacro %}
