{# todo: other sections than profile #}
{% if entry.section.handle != 'profile' %}
    {% set entry = currentSite.handle == 'agency' ? null : craft.entries.section('profile').one %}
{% endif %}


{% if entry %}
    {% cache using key "ldjson_#{entry.site.handle}_#{entry.id}" %}
        {% set contact = craft.contact %}

        {% set image = entry.featuredImage.one %}

        {% set birthDate = entry.birthday ? entry.birthday|date('Y-m-d') : '2000-01-01' %}

        {% set sameAs = [] %}
        {% set socialMedia = entry.socialMedia.all %}
        {% if socialMedia %}
            {% set sameAs = socialMedia|map(s => s.socialLink) %}
        {% endif %}
        {% if entry.links %}
            {% set sameAs = sameAs|merge(entry.links|map(s => s.url)) %}
        {% endif %}

        {% set schema = craft.schema %}

        {{ schema.person
            .name(entry.title)
            .image(image ? image.url({width: 300, height: 300}))
            .birthDate(birthDate)
            .jobTitle('Actor')
            .url(contact.webSite)
            .email(contact.eMail)
            .telephone(contact.telephone)
            .sameAs(sameAs)
            |raw
        }}

    {% endcache %}

{% endif %}
